<div class="container">
    <action-bar class="shadow"></action-bar>
    <div class="content">
        <h1 class="dashboard-title">Monitoreo global</h1>
        <div class="readings">
            <div class="dashboard-section dashboard-readings">
                <div class="dashboard-section--info">
                    <h3>Lecturas OK</h3>
                    <p>{{sensorFlat?.readings??0}}</p>
                </div>
                <img class="dashboard-section--img" src="./assets/OK.svg" alt="">
            </div>
            <div class="dashboard-section dashboard-readings">
                <div class="dashboard-section--info">
                    <h3>Alertas medias</h3>
                    <p>{{sensorFlat?.medium_alerts??0}}</p>
                </div>
                <img class="dashboard-section--img" src="./assets/alertas-medias.svg" alt="">
            </div>
            <div class="dashboard-section dashboard-readings">
                <div class="dashboard-section--info">
                    <h3>Alertas rojas</h3>
                    <p>{{sensorFlat?.red_alerts??0}}</p>
                </div>
                <img class="dashboard-section--img" src="./assets/alertas-rojas.svg" alt="">
            </div>
            <div class="dashboard-section dashboard-readings">
                <div class="dashboard-section--info">
                    <h3>Sensores deshabilitados</h3>
                    <p>{{sensorFlat?.disabled??0}}</p>
                </div>
                <img class="dashboard-section--img" src="./assets/deshabilitados.svg" alt="">
            </div>
        </div>
        <div class="dashboard-section dashboard-table">
            <div class="table-header">
                <h2>Plantas</h2>
                <button (click)="getInCreate()" class="table-header--button">+ Crear nueva planta</button>
            </div>
            <hr>
            <table>
                <tr>
                    <th>País</th>
                    <th>Nombre de la planta</th>
                    <th>Lecturas</th>
                    <th>Alertas medias</th>
                    <th>Alertas rojas</th>
                    <th>Acciones</th>
                </tr>
                <tr *ngFor="let factory of factories;let i=index">
                    <td>
                        <div class="td-flex">
                            <img class="flag" [src]="factory.flag" [alt]="'Bandera de '+factory.country">
                            {{factory.country}}
                        </div>
                    </td>
                    <td>{{factory.name}}</td>
                    <td>{{factory.readings}}</td>
                    <td>{{factory.medium_alerts}}</td>
                    <td>{{factory.red_alerts}}</td>
                    <td>
                        <div class="actions-menu-container">
                            <img class="icon rotate" src="./assets/acciones.svg" alt="">
                            <!-- <input name="actions-menu"  type="checkbox" [id]="'toogle-actions-menu-'+factory.id"> -->
                            <div class="actions-menu">
                                <button (click)="getInEdit(factory.id)" class="tooltip"><img src="./assets/edit.svg" alt=""><span class="tooltiptextup">Editar planta</span></button>
                                <button (click)="deleteFactory(factory.id)" class="tooltip"><img src="./assets/delete.svg" alt=""><span class="tooltiptextup">Eliminar planta</span></button>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>

        <div *ngIf="sensores" class="readings">
            <div class="dashboard-section dashboard-readings">
                <div class="dashboard-section--info">
                    <h3>Temperatura</h3>
                    <div class="dashboard-readings">
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/ok-l.svg" alt="">{{sensores[types.TEMPERATURA]?.readings??0}}</p>
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/alertas-medias-l.svg" alt="">{{sensores[types.TEMPERATURA]?.medium_alerts??0}}</p>
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/alertas-rojas-l.svg" alt="">{{sensores[types.TEMPERATURA]?.red_alerts??0}}</p>
                    </div>
                </div>
                <img class="dashboard-section--img" src="./assets/temperatura.svg" alt="">
            </div>
            <div class="dashboard-section dashboard-readings">
                <div class="dashboard-section--info">
                    <h3>Presión</h3>
                    <div class="dashboard-readings">
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/ok-l.svg" alt="">{{sensores[types.PRESION]?.readings??0}}</p>
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/alertas-medias-l.svg" alt="">{{sensores[types.PRESION]?.medium_alerts??0}}</p>
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/alertas-rojas-l.svg" alt="">{{sensores[types.PRESION]?.red_alerts??0}}</p>
                    </div>
                </div>
                <img class="dashboard-section--img" src="./assets/presion.svg" alt="">
            </div>
            <div class="dashboard-section dashboard-readings">
                <div class="dashboard-section--info">
                    <h3>Viento</h3>
                    <div class="dashboard-readings">
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/ok-l.svg" alt="">{{sensores[types.VIENTO]?.readings??0}}</p>
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/alertas-medias-l.svg" alt="">{{sensores[types.VIENTO]?.medium_alerts??0}}</p>
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/alertas-rojas-l.svg" alt="">{{sensores[types.VIENTO]?.red_alerts??0}}</p>
                    </div>
                </div>
                <img class="dashboard-section--img" src="./assets/viento.svg" alt="">
            </div>
            <div class="dashboard-section dashboard-readings">
                <div class="dashboard-section--info">
                    <h3>Niveles</h3>
                    <div class="dashboard-readings">
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/ok-l.svg" alt="">{{sensores[types.NIVELES]?.readings??0}}</p>
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/alertas-medias-l.svg" alt="">{{sensores[types.NIVELES]?.medium_alerts??0}}</p>
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/alertas-rojas-l.svg" alt="">{{sensores[types.NIVELES]?.red_alerts??0}}</p>
                    </div>
                </div>
                <img class="dashboard-section--img" src="./assets/niveles.svg" alt="">
            </div>
            <div class="dashboard-section dashboard-readings">
                <div class="dashboard-section--info">
                    <h3>Energía</h3>
                    <div class="dashboard-readings">
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/ok-l.svg" alt="">{{sensores[types.ENERGIA]?.readings??0}}</p>
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/alertas-medias-l.svg" alt="">{{sensores[types.ENERGIA]?.medium_alerts??0}}</p>
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/alertas-rojas-l.svg" alt="">{{sensores[types.ENERGIA]?.red_alerts??0}}</p>
                    </div>
                </div>
                <img class="dashboard-section--img" src="./assets/energia.svg" alt="">
            </div>
            <div class="dashboard-section dashboard-readings">
                <div class="dashboard-section--info">
                    <h3>Tensión</h3>
                    <div class="dashboard-readings">
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/ok-l.svg" alt="">{{sensores[types.TENSION]?.readings??0}}</p>
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/alertas-medias-l.svg" alt="">{{sensores[types.TENSION]?.medium_alerts??0}}</p>
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/alertas-rojas-l.svg" alt="">{{sensores[types.TENSION]?.red_alerts??0}}</p>
                    </div>
                </div>
                <img class="dashboard-section--img" src="./assets/tension.svg" alt="">
            </div>
            <div class="dashboard-section dashboard-readings">
                <div class="dashboard-section--info">
                    <h3>Monóxido de carbono</h3>
                    <div class="dashboard-readings">
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/ok-l.svg" alt="">{{sensores[types.CO2]?.readings??0}}</p>
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/alertas-medias-l.svg" alt="">{{sensores[types.CO2]?.medium_alerts??0}}</p>
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/alertas-rojas-l.svg" alt="">{{sensores[types.CO2]?.red_alerts??0}}</p>
                    </div>
                </div>
                <img class="dashboard-section--img" src="./assets/co2.svg" alt="">
            </div>
            <div class="dashboard-section dashboard-readings">
                <div class="dashboard-section--info">
                    <h3>Otros gases</h3>
                    <div class="dashboard-readings">
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/ok-l.svg" alt="">{{sensores[types.OTROS]?.readings??0}}</p>
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/alertas-medias-l.svg" alt="">{{sensores[types.OTROS]?.medium_alerts??0}}</p>
                        <p class="flex small-reading"><img class="icon-reading" src="./assets/alertas-rojas-l.svg" alt="">{{sensores[types.OTROS]?.red_alerts??0}}</p>
                    </div>
                </div>
                <img class="dashboard-section--img" src="./assets/otros-gases.svg" alt="">
            </div>
        </div>
    </div>
    
</div>
<div *ngIf="createMode==1" class="popup">
    <form [formGroup]="createFactoryForm" class="dashboard-section dashboard-form">
        <h2>Crear nueva planta</h2>
        <div class="dashboard-form--content">
            <label for="name">Nombre planta</label>
            <input type="text" placeholder="Ingrese nombre" id="name" formControlName="name">
            <label for="country">País</label>
            <select type="text" placeholder="Seleccione país" id="country" formControlName="country">
                <option [value]="null">Elegir opción</option>
                <option *ngFor="let country of countries;let i=index" [value]="i">
                    {{country.name.common}}
                </option>
            </select>
        </div>
        <div class="buttons-bar">
            <button type="button" (click)="getOutCreate()" class="secondary-button">Cancelar</button>
            <button type="submit" (click)="acceptCreate($event)" [disabled]="!createFactoryForm.valid" class="primary-button">Crear</button>
        </div>
        
    </form>
</div>
<div *ngIf="createMode==2" class="popup">
    <form [formGroup]="editFactoryForm" class="dashboard-section dashboard-form">
        <h2>Editar planta</h2>
        <div class="dashboard-form--content--grid">
            <label for="name">Nombre planta <input type="text" placeholder="Ingrese nombre" id="name" formControlName="name"></label>
            
            <label for="country">País <input type="text" id="country" formControlName="country"></label>
            <label for="type"> Tipo de sensor
                <select type="text" placeholder="Seleccione país" id="type" formControlName="type">
                    <option [value]="null">Elegir tipo</option>
                    <option *ngFor="let type of [types.CO2,types.ENERGIA,types.NIVELES,types.OTROS,types.PRESION,types.TEMPERATURA,types.TENSION,types.VIENTO]" [value]="type">
                        {{type}}
                    </option>
                </select>
            </label>
            <label for="readings">Cantidad de lecturas <input type="number" id="readings" formControlName="readings"></label>
            <label for="medium_alerts">Alertas medias<input type="number" id="medium_alerts" formControlName="medium_alerts"></label>
            <label for="red_alerts">Alertas rojas<input type="number" id="red_alerts" formControlName="red_alerts"></label>
            
            
        </div>
        <div class="buttons-bar">
            <button type="button" (click)="getOutEdit()" class="secondary-button">Cancelar</button>
            <button type="submit" (click)="acceptEdit($event)" [disabled]="!editFactoryForm.valid" class="primary-button">Editar</button>
        </div>
        
    </form>
</div>
<app-user-menu></app-user-menu>
